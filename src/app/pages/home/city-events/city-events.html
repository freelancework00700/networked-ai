<ion-header mode="md" >
  <ion-toolbar mode="md">
    <div class="relative w-full h-[140px] p-2 max-w-[672px] mx-auto">
      <div
        class="absolute inset-0 bg-cover bg-center events-bg"
        [style.background-image]="'url(' + (selectedCity().thumbnail_url || selectedCity().image_url || 'https://images.unsplash.com/photo-1489515217757-5fd1be406fef?auto=format&fit=crop&w=1200&q=80') + ')'"
      ></div>

      <div class="absolute inset-0 bg-black/40"></div>

      <div class="relative z-10 flex flex-col h-full px-6 pt-safe pb-6">
        <div
          class="w-12 h-12 rounded-full flex items-center justify-center bg-black/35 backdrop-blur-md border border-white/15 cursor-pointer"
          (click)="goBack()"
        >
          <i class="pi pi-arrow-left text-white text-[20px]"></i>
        </div>

        <div class="flex flex-1 flex-col items-center justify-center gap-1 cursor-pointer">
          <span class="text-white text-sm opacity-90"> Events in </span>

          <div class="flex items-center gap-2" (click)="openCitySelection()">
            <div class="pi pi-map-marker text-white !text-[20px]"></div>

            <span class="text-white text-xl font-semibold">
              {{ selectedCity().fullName || 'Select Location' }}
            </span>

            <div class="pi pi-chevron-down text-white"></div>
          </div>
        </div>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" mode="md">
  <div class="min-h-full">
    <div class="w-full max-w-[672px] mx-auto p-6">
      <div class="mb-4">
        <searchbar [searchQuery]="searchQuery()" [placeholder]="'Search events'" (searchChange)="onSearchChange($event)" (clear)="onSearchClear()" />
      </div>

      <div class="flex flex-col gap-4">
        @if (isLoadingEvents()) {
          <!-- Skeleton loaders -->
          @for (i of [1, 2, 3, 4, 5]; track i) {
            <div class="rounded-xl overflow-hidden">
              <ion-skeleton-text animated class="w-full h-48 rounded-t-xl"></ion-skeleton-text>
              <div class="p-4 flex flex-col gap-2">
                <ion-skeleton-text animated class="w-3/4 h-5 rounded"></ion-skeleton-text>
                <ion-skeleton-text animated class="w-1/2 h-4 rounded"></ion-skeleton-text>
                <ion-skeleton-text animated class="w-2/3 h-4 rounded"></ion-skeleton-text>
                <div class="flex items-center gap-2 mt-2">
                  <ion-skeleton-text animated class="w-16 h-4 rounded"></ion-skeleton-text>
                  <ion-skeleton-text animated class="w-20 h-4 rounded"></ion-skeleton-text>
                </div>
              </div>
            </div>
          }
        } @else if (allEvents().length === 0) {
          <app-empty-state [showClearButton]="!!searchQuery()" (clear)="onSearchClear()" />
        } @else {
          @for (event of allEvents(); track event.id || event.title || $index) {
            <event-card [event]="event" />
          }
        }
      </div>

      @if (hasMore()) {
        <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMoreEvents($event)">
          <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more events..." />
        </ion-infinite-scroll>
      }
    </div>
  </div>
</ion-content>
