<div class="flex flex-col gap-6 pt-3">
  <!-- host your first event card -->
  @if (currentUser()?.total_events_hosted === 0 || !isLoggedIn()) {
    <div class="pt-1 px-4">
      <host-first-event-card />
    </div>
  }

  @if (isLoggedIn()) {
    <!-- filter buttons -->
    <div class="flex gap-2 px-4">
      <button class="filter-button" (click)="filter.set('browse'); onFilterChange()" [class.active]="isBrowseMode()">Browse Events</button>
      <button class="filter-button" (click)="filter.set('upcoming'); onFilterChange()" [class.active]="isUpcomingMode()">My Upcoming Events</button>
    </div>
  }

  <!-- my upcoming events -->
  @if (isUpcomingMode()) {
    @if (isLoading()) {
      <!-- Skeleton for upcoming events -->
      <div class="px-4">
        <div class="flex items-center justify-between mb-4">
          <ion-skeleton-text animated class="w-40 h-5 rounded"></ion-skeleton-text>
          <ion-skeleton-text animated class="w-16 h-4 rounded"></ion-skeleton-text>
        </div>
      </div>
      <div class="flex flex-col gap-3 px-4">
        @for (i of [1, 2, 3]; track i) {
          <div class="rounded-xl overflow-hidden">
            <div class="flex gap-4 p-4">
              <ion-skeleton-text animated class="w-20 h-20 rounded-lg flex-shrink-0"></ion-skeleton-text>
              <div class="flex-1 flex flex-col gap-2">
                <ion-skeleton-text animated class="w-3/4 h-5 rounded"></ion-skeleton-text>
                <ion-skeleton-text animated class="w-1/2 h-4 rounded"></ion-skeleton-text>
                <ion-skeleton-text animated class="w-2/3 h-4 rounded"></ion-skeleton-text>
                <ion-skeleton-text animated class="w-full h-10 rounded-lg mt-2"></ion-skeleton-text>
              </div>
            </div>
          </div>
        }
      </div>
    } @else if (upcomingEvents().length > 0) {
      <div class="px-4">
        <div class="flex items-center justify-between">
          <div class="body-16SB neutral-01">My Upcoming Events</div>
          <button type="button" class="body-14SB brand-02" (click)="navigationService.navigateForward('/event/all?eventFilter=upcoming', true)">
            See all
          </button>
        </div>
      </div>

      <div>
        <div class="flex flex-col gap-3 px-4">
          @for (event of upcomingEvents(); track event.id || event.title) {
            <upcoming-event-card [event]="event" />
          }
        </div>
      </div>
    } @else {
      <div class="px-4">
        <no-upcoming-event-card (onBrowseClick)="filter.set('browse'); onFilterChange()" />
      </div>
    }
  }

  <!-- browse events by cities -->
  @if (isLoadingCities()) {
    <div class="px-4">
      <div class="flex items-center justify-between">
        <ion-skeleton-text animated class="w-40 h-5 rounded"></ion-skeleton-text>
        <ion-skeleton-text animated class="w-16 h-4 rounded"></ion-skeleton-text>
      </div>
    </div>
  } @else if (cityCards().length > 0) {
    <div class="px-4">
      <div class="flex items-center justify-between">
        <div class="body-16SB neutral-01">Browse events by cities</div>
        <button type="button" class="body-14SB brand-02" (click)="navigationService.navigateForward('/event/city')">See all</button>
      </div>
    </div>
  }

  <div>
    @if (isLoadingCities()) {
      <!-- Skeleton for cities -->
      <div class="swiper swiper-city" #swiperEl>
        <div class="swiper-wrapper">
          @for (i of [1, 2, 3, 4]; track i) {
            <div class="swiper-slide">
              <div class="relative h-[120px] shrink-0 rounded-[12px] overflow-hidden">
                <ion-skeleton-text animated class="w-full h-full"></ion-skeleton-text>
              </div>
            </div>
          }
        </div>
      </div>
    } @else {
      <div class="swiper swiper-city" #swiperEl >
        <div class="swiper-wrapper">
          @for (city of cityCards(); track city.city) {
            <div class="swiper-slide" (click)="onCityClick(city)">
              <city-card [city]="city" />
            </div>
          }
        </div>
      </div>
    }
  </div>

  <!-- events for you -->
  @if (isLoggedIn()) {
    @if (isLoading() && recommendedEvents().length === 0) {
      <!-- Skeleton for recommended events -->
      <div class="px-4">
        <div class="flex items-center justify-between mb-4">
          <ion-skeleton-text animated class="w-32 h-5 rounded"></ion-skeleton-text>
          <ion-skeleton-text animated class="w-16 h-4 rounded"></ion-skeleton-text>
        </div>
      </div>
      <div class="px-4">
        <div class="swiper swiper-event-recommendation" #swiperEventRecommendation>
          <div class="swiper-wrapper">
            @for (i of [1, 2, 3]; track i) {
              <div class="swiper-slide">
                <div class="rounded-xl overflow-hidden">
                  <ion-skeleton-text animated class="w-full h-48 rounded-t-xl"></ion-skeleton-text>
                  <div class="p-4 flex flex-col gap-2">
                    <ion-skeleton-text animated class="w-3/4 h-5 rounded"></ion-skeleton-text>
                    <ion-skeleton-text animated class="w-1/2 h-4 rounded"></ion-skeleton-text>
                    <ion-skeleton-text animated class="w-2/3 h-4 rounded"></ion-skeleton-text>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    } @else if (recommendedEvents().length > 0) {
      <div class="px-4">
        <div class="flex items-center justify-between">
          <div class="body-16SB neutral-01">Events for you</div>
          <button type="button" class="body-14SB brand-02" (click)="navigationService.navigateForward('/event/all?eventFilter=recommended', true)">
            See all
          </button>
        </div>
      </div>

      <div>
        <div class="swiper swiper-event-recommendation" #swiperEventRecommendation>
          <div class="swiper-wrapper">
            @for (event of recommendedEvents(); track event.id || event.title) {
              <div class="swiper-slide">
                <event-card [event]="event" />
              </div>
            }
          </div>
        </div>
      </div>
    }
  }

  @if (isBrowseMode()) {
    <!-- user recommendations -->
    <user-recommendations />

    <!-- feed recommendations -->
    <!-- <div class="px-4">
      @for (post of feedPosts; track post.id) {
        <div class="flex flex-col gap-3">
          <div class="flex items-center gap-3">
            <div class="relative flex-shrink-0">
              <img [src]="post.primaryUser.profileImage" class="w-10 h-10 rounded-full object-cover border-2 border-neutral-07" />
              <div
                class="absolute -bottom-0.5 -right-0.5 w-5 h-5 rounded-full bg-neutral-02 border-2 border-neutral-07 flex items-center justify-center"
              >
                <span class="body-10 neutral-07 font-medium">+{{ post.otherCount }}</span>
              </div>
            </div>
            <div class="flex-1 body-14 neutral-01">
              <span class="body-14SB neutral-01">{{ post.primaryUser.name }}</span>
              <span> and {{ post.otherCount }} others recently registered for </span>
              <span class="body-14SB neutral-01">{{ post.event.title }}</span>
            </div>
          </div>

          <event-card [event]="post.event" variant="compact" />
        </div>
      }
    </div> -->

    <!-- message recommendations -->
    <!-- <div class="px-4 py-3 bg-neutral-06">
      @for (suggestion of networkSuggestions; track suggestion.id) {
        <div class="flex gap-4">
          <div class="flex-1 flex flex-col gap-3">
            <div>
              <div class="body-14 neutral-01">
                <span class="body-14SB neutral-01">{{ suggestion.name }}</span>
                <span class="neutral-03 body-14R"> recently was in</span>
              </div>

              <div class="flex items-center gap-2">
                <span class="body-16SB neutral-01">{{ suggestion.location }}</span>
                <div class="h-4 w-[1px] bg-neutral-04"></div>
                <span class="body-14R neutral-03">{{ suggestion.distance }}</span>
              </div>
            </div>

            <div class="flex items-center gap-2 rounded-[12px]">
              <div
                class="flex-1 h-[40px] !rounded-[8px] bg-neutral-07 !border !border-[#dbdbdb] flex items-center justify-between gap-2 hover:bg-neutral-06 transition-colors !px-4 cursor-pointer"
              >
                <span class="body-14SB text-[var(--early-bird)]">Hey, let's network!</span>
                <div class="pi pi-send text-[var(--early-bird)]"></div>
              </div>

              <app-button label="" iconName="pi-comments" height="40px" width="40px" />
            </div>
          </div>

          <div class="relative w-[102px] h-[88px] rounded-[12px] overflow-hidden bg-neutral-02 flex-shrink-0">
            <div class="absolute inset-0 bg-cover bg-center" [style.background-image]="'url(' + suggestion.mapImage + ')'"></div>
            <div class="absolute inset-0 bg-neutral-02/70"></div>

            <div class="absolute inset-0 flex items-center justify-center z-10">
              <div class="relative">
                <img [src]="suggestion.profileImage" [alt]="suggestion.name" class="w-20 h-20 rounded-full object-cover border-2 border-neutral-07" />
                <div class="absolute -bottom-1 -right-1 bg-neutral-02 rounded-[6px] px-1.5 py-0.5 border border-neutral-03 shadow-sm">
                  <span class="body-10 neutral-07">{{ suggestion.timeAgo }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      }
    </div> -->

    <!-- public events -->
    @if (isLoading() && publicEvents().length === 0) {
      <!-- Skeleton for public events -->
      <div class="px-4">
        <div class="flex items-center justify-between mb-4">
          <ion-skeleton-text animated class="w-32 h-5 rounded"></ion-skeleton-text>
          <ion-skeleton-text animated class="w-16 h-4 rounded"></ion-skeleton-text>
        </div>
      </div>
      <div class="px-4">
        <div class="swiper swiper-public-event" #swiperPublicEvents>
          <div class="swiper-wrapper">
            @for (i of [1, 2, 3]; track i) {
              <div class="swiper-slide">
                <div class="rounded-xl overflow-hidden">
                  <ion-skeleton-text animated class="w-full h-48 rounded-t-xl"></ion-skeleton-text>
                  <div class="p-4 flex flex-col gap-2">
                    <ion-skeleton-text animated class="w-3/4 h-5 rounded"></ion-skeleton-text>
                    <ion-skeleton-text animated class="w-1/2 h-4 rounded"></ion-skeleton-text>
                    <ion-skeleton-text animated class="w-2/3 h-4 rounded"></ion-skeleton-text>
                  </div>
                </div>
              </div>
            }
          </div>
        </div>
      </div>
    } @else if (publicEvents().length > 0) {
      <div class="px-4">
        <div class="flex items-center justify-between">
          <div class="body-16SB neutral-01">Public events</div>
          <button type="button" class="body-14SB brand-02" (click)="navigationService.navigateForward('/event/all?eventFilter=public', true)">
            See all
          </button>
        </div>
      </div>

      <div>
        <div class="swiper swiper-public-event" #swiperPublicEvents>
          <div class="swiper-wrapper">
            @for (event of publicEvents(); track event.id || event.title) {
              <div class="swiper-slide">
                <event-card [event]="event" />
              </div>
            }
          </div>
        </div>
      </div>
    }
  }
</div>
