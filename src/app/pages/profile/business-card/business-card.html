<ion-header mode="md">
  <ion-toolbar mode="md">
    <div class="w-full py-6 px-4 max-w-[672px] mx-auto">
      <div class="flex items-center justify-between">
        <ion-icon name="arrow-back" class="text-[20px] cursor-pointer neutral-03" (click)="goBack()"></ion-icon>
        <div class="body-14SB neutral-01">{{ authService.currentUser()?.id === user()?.id ? 'Your Business Card' : 'Business Card' }}</div>
        <div class="w-[20px]"></div>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" mode="md">
  <div class="w-full px-4 max-w-[672px] mx-auto">
    @if (user()) {
      <!-- Business Card Display -->
      <div class="relative w-full">
        <!-- Background with gradient and pattern -->
        <div class="relative w-full min-h-[500px] rounded-4xl overflow-hidden bg-neutral-06" #cardDownloadSection>
          <!-- Background Image -->
          <img
            src="/assets/images/business-card-bg.png"
            alt="Business Card Background"
            class="absolute inset-0 w-full object-cover opacity-90 h-[160px]"
          />

          <!-- Card Content Overlay -->
          <div class="relative flex flex-col items-center justify-center p-6 min-h-[500px] z-10 gap-5 pt-[120px]">
            <!-- Downloadable Section -->
            <div class="w-full">
              <!-- White Card -->
              <div class="relative w-full bg-white rounded-4xl! p-6 gradient-bg">
                <!-- Profile Image -->
                <div class="flex justify-center mb-4">
                  <div class="w-[72px] min-w-[72px] h-[72px] rounded-full overflow-hidden relative">
                    @if (profileImage()) {
                      <img
                        placeholder
                        fill
                        [ngSrc]="getImageUrl(profileImage())"
                        [alt]="user()?.name || 'Profile'"
                        (error)="onImageError($event)"
                        class="object-cover rounded-full"
                      />
                    } @else {
                      <div class="w-full h-full flex items-center justify-center bg-neutral-05">
                        <ion-icon name="person-outline" class="text-[48px] neutral-03"></ion-icon>
                      </div>
                    }
                  </div>
                </div>

                <!-- Name -->
                <div class="text-center mb-1">
                  <h2 class="body-18SB neutral-01">{{ user()?.name || 'Name' }}</h2>
                </div>

                <!-- Location -->
                @if (location()) {
                  <div class="text-center mb-1">
                    <div class="flex items-center justify-center gap-1">
                      <ion-icon name="location-outline" class="text-[14px] neutral-03"></ion-icon>
                      <p class="body-12R neutral-03">{{ location() }}</p>
                    </div>
                  </div>
                }

                <!-- Username -->
                @if (user()?.username) {
                  <div class="text-center mb-4">
                    <p class="body-12R neutral-03">{{ user()?.username }}</p>
                  </div>
                }

                <!-- QR Code -->
                <div class="flex justify-center">
                  <div class="bg-white p-2 rounded-2xl border border-neutral-200 gradient-border flex items-center justify-center">
                    <qr-code [value]="user()?.username" [size]="128" errorCorrectionLevel="M"></qr-code>
                  </div>
                </div>
              </div>

              <!-- Contact Information -->
              <div class="flex flex-col gap-3 mb-6 w-full mt-4">
                @for (link of visibleLinks(); track link.type) {
                  <div class="flex items-center gap-3 p-4 border border-neutral-300 rounded-4xl bg-neutral-07 contact-info-item">
                    <ion-icon [name]="link.icon" class="text-[20px] neutral-03 shrink-0"></ion-icon>
                    <a
                      [href]="link.href"
                      [target]="link.type === 'email' || link.type === 'phone' ? '_self' : '_blank'"
                      [rel]="link.type !== 'email' && link.type !== 'phone' ? 'noopener noreferrer' : ''"
                      class="flex-1 body-14M neutral-01 truncate min-w-0"
                    >
                      {{ link.label }}
                    </a>
                  </div>
                }

                @if (hiddenLinksCount() > 0) {
                  <button
                    type="button"
                    class="flex items-center justify-center p-4 border rounded-xl bg-neutral-06 cursor-pointer hover:bg-neutral-06 transition-colors w-full contact-info-item show-more-btn"
                    (click)="toggleShowMore()"
                  >
                    <span class="body-14M neutral-03">Show more ({{ hiddenLinksCount() }})</span>
                    <ion-icon [name]="showMoreLinks() ? 'chevron-up-outline' : 'chevron-down-outline'" class="text-[20px] neutral-03"></ion-icon>
                  </button>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </div>
</ion-content>

<ion-footer mode="md">
  <ion-toolbar mode="md">
    <div class="w-full px-4 py-4 max-w-[672px] mx-auto">
      <!-- Download Button -->
      <div class="flex gap-3">
        <app-button color="secondary" label="Download" iconName="pi-download" (click)="onDownload()" class="flex-1" />
      </div>
    </div>
    <!-- Share Footer -->
    <common-share-footer
      (onContact)="onContact()"
      (onCopyLink)="onCopyLink()"
      (onShareTo)="onShareTo()"
      (onChat)="onChat()"
      (onEmail)="onEmail()"
      (onWhatsapp)="onWhatsapp()"
      (onX)="onShareToX()"
      (onThread)="onShareToThreads()"
    />
  </ion-toolbar>
</ion-footer>
