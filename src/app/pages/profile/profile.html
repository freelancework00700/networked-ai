@if (isLoggedIn()) {
  <ion-header mode="md">
    <ion-toolbar mode="md">
      <div class="w-full py-6 px-4 max-w-[672px] mx-auto">
        @if (isViewingOtherProfile()) {
          <div class="flex items-center justify-between">
            <ion-icon name="arrow-back" class="text-[20px] cursor-pointer neutral-03" (click)="navigationService.back()"></ion-icon>
            <div class="body-14SB neutral-01">{{ currentUser()?.username || currentUser()?.name }}</div>
            <ion-icon src="/assets/svg/menu-dot.svg" (click)="openProfileOptionsPopover($event)" class="text-[20px] cursor-pointer" />
          </div>
        } @else {
          <!-- Current User Header: Existing toolbar -->
          <profile-header-toolbar [showMenuIcon]="true" />
        }
      </div>
    </ion-toolbar>
  </ion-header>
}
<ion-content [fullscreen]="true">
  @if (isLoggedIn()) {
    <div class="w-full px-4 max-w-[672px] mx-auto">
      <div class="flex flex-col items-start gap-6 bg-neutral-07">
        <div class="flex flex-col items-start gap-4 bg-neutral-07 w-full">
          <div class="flex items-center w-full">
            <!-- Profile image -->
            <div class="w-[72px] min-w-[72px] h-[72px] rounded-full overflow-hidden relative cursor-pointer" (click)="onProfileImageClick()">
              <img 
                fill
                placeholder
                [alt]="currentUser()?.name"
                (error)="onImageError($event)"
                [ngSrc]="profileImage()"
                class="object-cover rounded-full"
              />
            </div>

            <!-- Stats -->
            <div class="flex items-center w-full">
              <div class="flex flex-col items-center w-full">
                <div class="heading-h3 neutral-01">{{ currentUser()?.total_networks || 0 }}</div>
                <div class="body-12 neutral-03">Networks</div>
              </div>
              <div class="flex flex-col items-center w-full">
                <div class="heading-h3 neutral-01">{{ eventsCount() }}</div>
                <div class="body-12 neutral-03">Events</div>
              </div>
              <div class="flex flex-col items-center w-full">
                <div class="heading-h3 neutral-01">{{ currentUser()?.total_events_attended || 0 }}</div>
                <div class="body-12 neutral-03">Attended</div>
              </div>
            </div>
          </div>
          <div class="flex flex-col gap-3">
            <!-- Name -->
            <div class="flex items-center gap-2">
              <div class="heading-h3 neutral-01">{{ currentUser()?.name }}</div>
              @if (isViewingOtherProfile()) {
                <div class="flex items-center gap-1 border border-[#dbdbdb] rounded-full py-0 h-[20px]">
                  <img [src]="achievementDiamondPath()" alt="diamond" class="h-4 w-auto ml-1.5" />
                  <span class="text-sm font-medium pr-2">{{ currentUser()?.total_gamification_points || 0 }}</span>
                </div>
              }
            </div>
            <div>
              <!-- Location -->
              @if (currentUser()?.address) {
                <div class="flex items-center gap-2 body-14R neutral-03">
                  <ion-icon src="/assets/svg/location-icon.svg" class="text-[16px]"></ion-icon>
                  <span>{{ currentUser()?.address }}</span>
                </div>
              }

              <!-- Title -->
              @if (currentUser()?.company_name ) {
                <div class="flex items-center gap-2 body-14R neutral-03">
                  <ion-icon src="/assets/svg/briefcase.svg" class="text-[16px]"></ion-icon>
                  <span>{{ currentUser()?.company_name }}</span>
                </div>
              }
            </div>

            <!-- description -->
              <div class="w-full flex flex-col gap-1 body-14R neutral-01">
                  <div class="whitespace-pre-line">{{ currentUser()?.description }}</div>
              </div>
          </div>
          <!-- Links -->
          <profile-link [currentUser]="currentUser()" class="w-full" />
        </div>

        @if (!isViewingOtherProfile()) {
          <!-- Action Buttons -->
          <div class="w-full flex flex-col gap-3">
            <!-- Top Row: Edit Profile and Share Profile -->
            <div class="flex items-center gap-3">
              <app-button
                label="Edit Profile"
                iconName="pi-pencil"
                color="secondary"
                (click)="navigationService.navigateForward('/profile/edit')"
                class="w-full"
              />
              <app-button label="Share Profile" iconName="pi-share-alt" color="secondary" class="w-full" />
            </div>
            <!-- Bottom Row: Set Up Subscription -->
            <button type="button" class="w-full h-[44px] body-14SB neutral-01 !rounded-lg bg-[#2B5BDE] flex gap-2 justify-center items-center">
              <ion-icon src="/assets/svg/crown-white.svg" class="text-[18px]"></ion-icon>
              <span class="body-14SB neutral-07">Set Up Subscription</span>
            </button>
          </div>

          <!-- Networking Score Card -->
          <div class="w-full">
            <networking-score-card [score]="currentUser()?.total_gamification_points || 0" />
          </div>
  
          <!-- Business Card -->
          <div class="w-full">
            <business-card />
          </div>
        }

        <div class="bg-neutral-07 w-full">
          <div class="w-full flex items-center min-h-[48px]">
            @for (slide of slides; track slide.value) {
              <div class="flex-1 flex items-center justify-center cursor-pointer" (click)="changeTab(slide.value)">
                <ion-icon [src]="currentSlide() === slide.value ? slide.iconActive : slide.icon" class="text-[20px]" />
              </div>
            }
          </div>
          <div class="swiper swiper-profile">
            <div class="swiper-wrapper">
              <div class="swiper-slide">
                <profile-hosted-events [events]="events" />
              </div>
              <div class="swiper-slide">
                <profile-attended-events [events]="events" />
              </div>
              <div class="swiper-slide">
                <profile-upcoming-events [events]="events" />
              </div>
              <div class="swiper-slide">
                <profile-posts [posts]="posts" />
              </div>
              <div class="swiper-slide">
                <profile-achievement />
              </div>
            </div>
            <div class="swiper-scrollbar"></div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <auth-empty-state type="profile" />
  }
</ion-content>

<!-- Profile Image Preview Overlay -->
@if (showImagePreview()) {
  <profile-image-preview-overlay
    [user]="currentUser()"
    [isViewingOtherProfile]="isViewingOtherProfile()"
    (closeOverlay)="onCloseImagePreview()"
  />
}
