@if (isLoading()) {
  <ion-header mode="md">
    <ion-toolbar mode="md">
      <div class="w-full py-6 px-4 max-w-[672px] mx-auto flex items-center justify-between">
        <ion-skeleton-text animated class="w-6 h-6 rounded"></ion-skeleton-text>
        <ion-skeleton-text animated class="w-40 h-4 rounded"></ion-skeleton-text>
        <ion-skeleton-text animated class="w-6 h-6 rounded"></ion-skeleton-text>
      </div>
    </ion-toolbar>
  </ion-header>

  <ion-content [fullscreen]="true">
    <div class="w-full px-4 max-w-[672px] mx-auto">
      <div class="flex flex-col gap-6">
        <!-- Profile Image + Stats -->
        <div class="flex items-center gap-4">
          <ion-skeleton-text animated class="w-[72px] h-[60px] rounded-full"></ion-skeleton-text>

          <div class="flex items-center w-full">
            @for (i of [1, 2, 3]; track i) {
              <div class="flex-1 flex flex-col items-center gap-2">
                <ion-skeleton-text animated class="w-6 h-5 rounded"></ion-skeleton-text>
                <ion-skeleton-text animated class="w-12 h-3 rounded"></ion-skeleton-text>
              </div>
            }
          </div>
        </div>

        <!-- Username + Points -->
        <div class="flex items-center gap-2">
          <ion-skeleton-text animated class="w-40 h-6 rounded"></ion-skeleton-text>
          <ion-skeleton-text animated class="w-14 h-4 rounded-full"></ion-skeleton-text>
        </div>

        <!-- Location / Company -->
        <div class="flex flex-col gap-2">
          <ion-skeleton-text animated class="w-48 h-4 rounded"></ion-skeleton-text>
          <ion-skeleton-text animated class="w-36 h-4 rounded"></ion-skeleton-text>
        </div>

        <!-- Description -->
        <div class="flex flex-col gap-2">
          <ion-skeleton-text animated class="w-full h-4 rounded"></ion-skeleton-text>
          <ion-skeleton-text animated class="w-5/6 h-4 rounded"></ion-skeleton-text>
          <ion-skeleton-text animated class="w-3/4 h-4 rounded"></ion-skeleton-text>
        </div>

        <!-- Message Button -->
        <ion-skeleton-text animated class="w-full h-[44px] rounded-lg"></ion-skeleton-text>

        <!-- Tabs -->
        <div class="flex items-center justify-between py-2">
          @for (i of [1, 2, 3, 4, 5]; track i) {
            <ion-skeleton-text animated class="w-10 h-10 rounded-full"></ion-skeleton-text>
          }
        </div>

        <!-- Hosted Event Card -->
        <div class="rounded-xl overflow-hidden">
          <ion-skeleton-text animated class="w-full h-[220px]"></ion-skeleton-text>

          <div class="p-4 flex flex-col gap-2">
            <ion-skeleton-text animated class="w-32 h-4 rounded"></ion-skeleton-text>
            <ion-skeleton-text animated class="w-48 h-3 rounded"></ion-skeleton-text>
            <ion-skeleton-text animated class="w-56 h-3 rounded"></ion-skeleton-text>
          </div>
        </div>
      </div>
    </div>
  </ion-content>
} @else {
  @if (isLoggedIn()) {
    <ion-header mode="md">
      <ion-toolbar mode="md">
        <div class="w-full py-6 px-4 max-w-[672px] mx-auto">
          @if (isViewingOtherProfile()) {
            <div class="flex items-center justify-between">
              <ion-icon name="arrow-back" class="text-[20px] cursor-pointer neutral-03" (click)="navCtrl.back()"></ion-icon>
              <div class="body-14SB neutral-01">{{ currentUser()?.username || currentUser()?.name }}</div>
              <ion-icon src="/assets/svg/menu-dot.svg" (click)="openProfileOptionsPopover($event)" class="text-[20px] cursor-pointer" />
            </div>
          } @else {
            <!-- Current User Header: Existing toolbar -->
            <profile-header-toolbar [showMenuIcon]="true" />
          }
        </div>
      </ion-toolbar>
    </ion-header>
  }
  <ion-content [fullscreen]="true" [scrollEvents]="true">
    @if (isLoggedIn()) {
      <div class="w-full px-4 max-w-[672px] mx-auto">
        <div class="flex flex-col items-start gap-6 bg-neutral-07">
          <div class="flex flex-col items-start gap-4 bg-neutral-07 w-full">
            <div class="flex items-center w-full">
              <!-- Profile image -->
              <div class="w-[72px] min-w-[72px] h-[72px] rounded-full overflow-hidden relative cursor-pointer" (click)="onProfileImageClick()">
                <img
                  fill
                  placeholder
                  [alt]="currentUser()?.name"
                  (error)="onImageError($event)"
                  [ngSrc]="profileImage()"
                  class="object-cover rounded-full"
                />
              </div>

              <!-- Stats -->
              <div class="flex items-center w-full">
                <div class="flex flex-col items-center w-full cursor-pointer" (click)="currentUser()?.total_networks > 0 && navigateToNetworks()">
                  <div class="heading-h3 neutral-01">{{ currentUser()?.total_networks || 0 }}</div>
                  <div class="body-12 neutral-03">Networks</div>
                </div>
                <div class="flex flex-col items-center w-full cursor-pointer" (click)="eventsCount() > 0 && navigateToHostedEvents()">
                  <div class="heading-h3 neutral-01">{{ eventsCount() }}</div>
                  <div class="body-12 neutral-03">Events</div>
                </div>
                <div class="flex flex-col items-center w-full cursor-pointer" (click)="currentUser()?.total_events_attended > 0 && navigateToAttendedEvents()">
                  <div class="heading-h3 neutral-01">{{ currentUser()?.total_events_attended || 0 }}</div>
                  <div class="body-12 neutral-03">Attended</div>
                </div>
              </div>
            </div>
            <div class="flex flex-col gap-3">
              <!-- Name -->
              <div class="flex items-center gap-2">
                <div class="heading-h3 neutral-01">{{ currentUser()?.name || currentUser()?.username }}</div>
                @if (isViewingOtherProfile()) {
                  <div class="flex items-center gap-1 border border-[#dbdbdb] rounded-full py-0 h-[20px]">
                    <img [src]="achievementDiamondPath()" alt="diamond" class="h-4 w-auto ml-1.5" />
                    <span class="text-sm font-medium pr-2">{{ currentUser()?.total_gamification_points || 0 }}</span>
                  </div>
                }
              </div>
              <div>
                <!-- Location -->
                @if (currentUser()?.address) {
                  <div class="flex items-center gap-2 body-14R neutral-03">
                    <ion-icon src="/assets/svg/location-icon.svg" class="text-[16px]"></ion-icon>
                    <span>{{ currentUser()?.address }}</span>
                  </div>
                }

                <!-- Title -->
                @if (currentUser()?.company_name) {
                  <div class="flex items-center gap-2 body-14R neutral-03">
                    <ion-icon src="/assets/svg/briefcase.svg" class="text-[16px]"></ion-icon>
                    <span>{{ currentUser()?.company_name }}</span>
                  </div>
                }
              </div>

              <!-- description -->
              <div class="w-full flex flex-col gap-1 body-14R neutral-01">
                <div class="whitespace-pre-line">{{ currentUser()?.description }}</div>
              </div>
            </div>
            <!-- Links -->
            <profile-link [currentUser]="currentUser()" class="w-full" />
          </div>

          @if (isViewingOtherProfile()) {
            <!-- Action Buttons for Other User -->
            <div class="w-full flex items-center gap-3">
              <!-- Primary Action Button (Message/Add/Accept/Pending) -->
              @if (getPrimaryActionButton(); as primaryAction) {
                <app-button
                  [label]="primaryAction.label"
                  [iconName]="primaryAction.iconName"
                  color="primary"
                  [disabled]="primaryAction.disabled"
                  [isLoading]="primaryAction.isLoading"
                  (click)="handlePrimaryAction(primaryAction.action)"
                  class="flex-1"
                />
              }

              @if (hasSubscriptionPlan()) {
                @if (isSubscribedToUser()) {
                  <app-button
                    label="Subscribed"
                    icon="/assets/svg/crown-black.svg"
                    color="secondary"
                    (click)="navigateToUserSubscriptionPlans()"
                    class="flex-1"
                  />
                } @else if (shouldShowSubscribe()) {
                  <app-button
                    label="Subscribe"
                    icon="/assets/svg/crown-white.svg"
                    customColor="#2B5BDE"
                    (click)="navigateToUserSubscriptionPlans()"
                    class="flex-1"
                  />
                }
              }
              <!-- Remove Connection Button (only when connected) -->
              @if (isConnected()) {
                <app-button
                  label=""
                  iconName="pi-user-minus"
                  color="secondary"
                  (click)="showRemoveConnectionAlert()"
                  [width]="'48px'"
                  [height]="'47.19px'"
                  [radius]="'8px'"
                />
              }
            </div>
          }

          @if (!isViewingOtherProfile()) {
            <!-- Action Buttons -->
            <div class="w-full flex flex-col gap-3">
              <!-- Top Row: Edit Profile, Share Profile, and Business Card (if has social data) -->
              <div class="flex items-center gap-3">
                <app-button
                  label="Edit Profile"
                  iconName="pi-pencil"
                  color="secondary"
                  (click)="navigationService.navigateForward('/profile/edit')"
                  class="w-full"
                />
                <app-button label="Share Profile" iconName="pi-share-alt" color="secondary" class="w-full" (click)="openShareProfileModal()" />
                @if (!shouldShowCreateCard()) {
                  <app-button
                    type="button"
                    class="flex items-center justify-center min-w-[48px] h-[44px] !rounded-lg"
                    color="primary"
                    (click)="openBusinessCard()"
                    icon="/assets/svg/profile/business-card-icon.svg"
                  ></app-button>
                }
              </div>
              <!-- Bottom Row: Set Up Subscription -->
              <app-button
                [label]="!hasSubscriptionPlan() ? 'Set Up Subscription': 'My Subscription Plans'"
                icon="/assets/svg/crown-white.svg"
                customColor="#2B5BDE"
                (click)="navigateToSubscriptionPlans()"
                class="w-full"
              />
            </div>

            <!-- Networking Score Card -->
            <div class="w-full">
              <networking-score-card [score]="currentUser()?.total_gamification_points || 0" />
            </div>

            @if (shouldShowCreateCard()) {
              <div class="w-full">
                <business-card [user]="currentUser()" />
              </div>
            }
          }

          <div class="bg-neutral-07 w-full">
            <div class="w-full flex items-center min-h-[48px]">
              @for (slide of slides; track slide.value) {
                <div class="flex-1 flex items-center justify-center cursor-pointer" (click)="changeTab(slide.value)">
                  <ion-icon [src]="currentSlide() === slide.value ? slide.iconActive : slide.icon" class="text-[20px]" />
                </div>
              }
            </div>
            <div class="swiper swiper-profile">
              <div class="swiper-wrapper">
                <div class="swiper-slide">
                  <profile-hosted-events [userId]="currentUser()?.id || null" />
                </div>
                <div class="swiper-slide">
                  <profile-attended-events [userId]="currentUser()?.id || null" />
                </div>
                <div class="swiper-slide">
                  <profile-upcoming-events [userId]="currentUser()?.id || null" />
                </div>
                <div class="swiper-slide">
                  <profile-posts [userId]="currentUser()?.id || null" />
                </div>
                <div class="swiper-slide">
                  <profile-achievement [user]="currentUser()" />
                </div>
              </div>
              <div class="swiper-scrollbar"></div>
            </div>
          </div>
        </div>
      </div>
    } @else {
      <auth-empty-state type="profile" />
    }
  </ion-content>

  <!-- Profile Image Preview Overlay -->
  @if (showImagePreview()) {
    <profile-image-preview-overlay [user]="currentUser()" [isViewingOtherProfile]="isViewingOtherProfile()" (closeOverlay)="onCloseImagePreview()" />
  }
}
