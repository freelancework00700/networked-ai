<!-- Subscribers Exclusive Section -->
@if (subscriptionPlans().length > 0) {
  <div class="flex p-3 my-3 border border-surface-300 rounded-lg gap-4" [formGroup]="eventForm()">
    <!-- left: crown icon -->
    <img src="assets/svg/subscriber_exclusive.svg" alt="Subscribers Exclusive" class="w-10 h-10" />

    <!-- middle: text -->
    <div class="flex-1">
      <div class="font-bold mb-1">Subscribers Exclusive</div>
      <div class="text-sm text-surface-600">Only subscribers can RSVP for this event.</div>
    </div>

    <!-- right: toggle switch -->
    <div class="flex items-center">
      <p-toggleSwitch formControlName="is_subscriber_exclusive" />
    </div>
  </div>
}

<!-- Regular Ticket/Promo Flow (shown when is_subscriber_exclusive is false) -->
@if (tickets().length === 0 && subscriptionPlans().length === 0 && !isSubscriberExclusive()) {
  <div class="flex flex-col items-center justify-center">
    <ion-icon src="assets/svg/ticket/no-tickets.svg" class="w-45 h-45 mx-auto pb-8" />
    <div class="heading-h3 neutral-01 text-center">Ready to Sell Tickets?</div>
    <div class="body-14M text-surface-500 text-center">Offer early bird specials, VIP packages, or free entryâ€”it's up to you.</div>
  </div>
}

<!-- Ticket List Section -->
@if (tickets().length > 0 && !isSubscriberExclusive()) {
  <ion-reorder-group [disabled]="tickets().length <= 1" (ionItemReorder)="handleTicketReorder($event)">
    @for (ticket of tickets(); track ticket.id || $index; let index = $index) {
      <ticket-card
        [ticket]="ticket"
        [eventDate]="getFieldValue('date')"
        [eventStartTime]="getFieldValue('start_time')"
        (edit)="editTicket(index)"
        (delete)="deleteTicket(index)"
      />
    }
  </ion-reorder-group>
}

<!-- Subscription Section (Free for Plan Subscribers) -->
@if ((tickets().length > 0 && !isEventCompletelyFree()) || isSubscriberExclusive()) {
  <subscription-input [plans]="subscriptionPlans()" [subscriberExclusiveMode]="isSubscriberExclusive()" />
}

<!-- Promo Code Section -->
@if (tickets().length > 0 && !isSubscriberExclusive()) {
  <div class="py-4" [class.opacity-50]="isEventCompletelyFree()">
    <div
      class="flex items-center justify-between cursor-pointer"
      (click)="!isEventCompletelyFree() && promoCodeSectionOpen.set(!promoCodeSectionOpen())"
    >
      <div class="body-medium-16" [class.natural-03]="isEventCompletelyFree()" [class.natural-01]="!isEventCompletelyFree()">Promo Code(s)</div>

      @if (!isEventCompletelyFree()) {
        <i [class]="promoCodeSectionOpen() ? 'pi pi-chevron-up text-lg' : 'pi pi-chevron-down text-lg'"></i>
      }
    </div>

    @if (promoCodeSectionOpen() || isEventCompletelyFree()) {
      <div class="mt-3">
        @if (isEventCompletelyFree()) {
          <div class="body-regular-14 natural-03">Unapplicable to free events</div>
        } @else {
          @if (promoCodes().length > 0) {
            <div class="flex flex-col gap-3">
              @for (promo of promoCodes(); track promo.promo_code) {
                <promo-code-card
                  [promo]="promo"
                  (edit)="editPromoCode(getPromoCodeOriginalIndex(promo))"
                  (delete)="deletePromoCode(getPromoCodeOriginalIndex(promo))"
                />
              }
            </div>
          }

          <div class="flex justify-center pb-4">
            <button class="body-medium-14 brand-02" (click)="resetPromoForm()" type="button">
              <i class="pi pi-plus"></i>
              Create New
            </button>
          </div>
        }
      </div>
    }
  </div>
}

<!-- Advanced Settings Section -->
@if (tickets().length > 0 && !isSubscriberExclusive()) {
  <div class="py-4" [class.opacity-50]="isEventCompletelyFree()" [class.pointer-events-none]="isEventCompletelyFree()">
    <div
      class="flex items-center justify-between"
      [class.cursor-pointer]="!isEventCompletelyFree()"
      [class.cursor-not-allowed]="isEventCompletelyFree()"
      (click)="!isEventCompletelyFree() && advancedSettingsOpen.set(!advancedSettingsOpen())"
    >
      <div class="body-medium-16" [class.natural-03]="isEventCompletelyFree()" [class.natural-01]="!isEventCompletelyFree()">Advanced Settings</div>

      @if (!isEventCompletelyFree()) {
        <i [class]="advancedSettingsOpen() ? 'pi pi-chevron-up text-lg' : 'pi pi-chevron-down text-lg'"></i>
      }
    </div>

    @if (advancedSettingsOpen() || isEventCompletelyFree()) {
      <div class="mt-3">
        @if (isEventCompletelyFree()) {
          <div class="body-regular-14 natural-03">Unapplicable to free events</div>
        } @else {
          <div class="w-full border-l-2 border-neutral-300 pl-4" [formGroup]="eventForm()">
            @if (!getFieldValue('host_pays_platform_fee')) {
              <div class="flex items-center gap-4 mb-2">
                <toggle-input controlName="guest_fee_enabled" label="Additional fee for guests (%)" />
              </div>

              @if (getFieldValue('guest_fee_enabled')) {
                <div class="w-[100px]">
                  <number-input
                    [formGroup]="eventForm()"
                    controlName="additional_fees"
                    placeholder="0%"
                    [max]="100"
                    [min]="0"
                    [required]="getFieldValue('guest_fee_enabled') ?? false"
                  />
                </div>
              }
            }
            <div class="flex items-center gap-3 mt-4">
              <p-checkbox formControlName="host_pays_platform_fee" [binary]="true"></p-checkbox>
              <div class="body-regular-14 natural-01">Hosts will pay the platform fees</div>
            </div>
          </div>
        }
      </div>
    }
  </div>
}
