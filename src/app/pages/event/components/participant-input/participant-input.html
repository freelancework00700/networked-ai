<div class="flex items-center justify-between">
  <div class="neutral-02 body-14M flex-1">{{ label() }}</div>
  @if (!showSearch()) {
    <app-button (click)="onAddClick()" [label]="'Add'" [iconName]="'pi pi-plus'" [variant]="'text'" iconPos="right" [height]="'10px'" class="p-0" />
  }
</div>

<!-- Existing Users -->
@if (users().length > 0) {
  <div class="flex flex-col gap-2 mb-4 border-l-3 border-surface-200 pl-4 my-2">
    @for (user of users(); track user.id) {
      <div class="flex items-center justify-between border border-surface-300 rounded-lg px-3 py-2 w-full">
        <div class="flex items-center gap-3">
          <div class="relative w-10 h-10 overflow-hidden rounded-full">
            <img
              fill
              placeholder 
              [ngSrc]="getImageUrl(user.thumbnail_url)"
              (error)="onImageError($event)"
              [alt]="user.name"
              class="rounded-full object-cover"
            />
          </div>
          <span class="body-regular-14">{{ user.name }}</span>
        </div>
        <button type="button" class="p-0 m-0 bg-transparent border-none cursor-pointer shrink-0" (click)="onRemoveUser(user.id!)">
          <i class="pi pi-times text-lg text-neutral-04"></i>
        </button>
      </div>
    }
  </div>
}

<!-- Search Input -->
@if (showSearch()) {
  <div class="relative mb-4 border-l-3 border-surface-200 pl-4 my-2">
    <div class="flex gap-2 items-center relative">
      <searchbar
        class="w-full"
        [searchQuery]="searchQuery()"
        (searchChange)="onSearchInput($event)"
        [placeholder]="'Search by username, email or phone'"
      />

      @if (isSearching()) {
        <div class="absolute top-full left-0 right-0 z-10 bg-white border border-surface-300 rounded-lg shadow-lg mt-1 p-4 max-h-60 overflow-y-auto">
          <div class="flex items-center justify-center">
            <span class="text-sm text-gray-500">Searching...</span>
          </div>
        </div>
      } @else if (filteredUsers().length > 0) {
        <div class="absolute top-full left-0 right-0 z-10 bg-white border border-surface-300 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto p-4">
          @for (filteredUser of filteredUsers(); track filteredUser.id) {
            <div class="flex items-center gap-3 p-3 cursor-pointer hover:bg-gray-50" (click)="onSelectUser(filteredUser)">
              <div class="relative w-10 h-10 rounded-full overflow-hidden">
                <img
                  fill
                  class="object-cover"
                  (error)="onImageError($event)"
                  [ngSrc]="getImageUrl(filteredUser.thumbnail_url)"
                  [loaderParams]="{ thumbnail: filteredUser.thumbnail_url }"
                />
              </div>
              <span class="body-regular-14">{{ filteredUser.name }}</span>
            </div>
          }
        </div>
      }
    </div>
  </div>
}
