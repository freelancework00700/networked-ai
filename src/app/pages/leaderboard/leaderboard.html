<ion-header mode="md">
  <ion-toolbar>
    <div class="flex items-center gap-2 max-sm:px-4 pt-2.5 cursor-pointer max-w-[672px] mx-auto">
      <div class="pi pi-arrow-left" (click)="navCtrl.back()"></div>
      <div class="body-14M neutral-02 text-center w-full">Leaderboard</div>
      <div class="pi pi-question-circle" (click)="navCtrl.navigateForward('/about-achievements')"></div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" mode="md">
  <div class="min-h-full">
    <div class="w-full max-w-[672px] mx-auto px-4 pb-6">
      <div class="pt-4 pb-2">
        <segment-button [items]="tabItems" [value]="tab()" (valueChange)="onSegmentChange($event)" />
      </div>

      @if (isLoading()) {
        <div class="text-center py-8">
          <div class="body-14M text-neutral-03">Loading leaderboard...</div>
        </div>
      } @else if (topThree().length > 0) {
        <div class="gradient-gold rounded-[12px] p-[3px] my-4">
          <div class="rounded-[8px] bg-[#F0F0F0] pt-4">
            <div class="grid grid-cols-3 gap-4 items-end">
              @for (user of topThree(); track user.id || user.rank) {
                <div
                  class="flex flex-col items-center text-center transition-all cursor-pointer"
                  [class.order-2]="user.rank === 1"
                  [class.order-1]="user.rank === 2"
                  [class.order-3]="user.rank === 3"
                  (click)="onUserClick(user.username)"
                >
                  @if (user.rank === 1) {
                    <div class="gradient-gold rounded-full w-16.5! h-16.5! flex items-center justify-center">
                      <div class="w-15 h-15 rounded-full object-cover overflow-hidden relative">
                        <img
                          fill
                          placeholder
                          [ngSrc]="getUserImage(user)"
                          [alt]="user.name"
                          class="rounded-full object-cover"
                          (error)="onImageError($event)"
                        />
                      </div>
                    </div>
                  } @else {
                    <div class="w-15 h-15 rounded-full object-cover overflow-hidden relative border-2 border-white shadow-md">
                    <img
                      fill
                      placeholder
                      [ngSrc]="getUserImage(user)"
                      [alt]="user.name"
                      (error)="onImageError($event)"
                      />
                    </div>
                  }

                  <div class="mt-2">
                    <div class="body-14M font-semibold text-neutral-01">
                      {{ getUserDisplayName(user) }}
                    </div>
                    <div class="body-12M text-surface-500">
                      {{ formatScore(user.points) }}
                    </div>
                  </div>

                  <!-- Rank badge -->
                  <div class="mt-3">
                    @if (user.rank === 1) {
                      <div class="podium-first">
                        <span class="text-[25px] font-extrabold text-[#8f703fe6]">1</span>
                      </div>
                    } @else if (user.rank === 2) {
                      <div class="podium-second">
                        <span class="text-[25px] font-extrabold text-[#343435]">2</span>
                      </div>
                    } @else if (user.rank === 3) {
                      <div class="podium-third">
                        <span class="text-[25px] font-extrabold text-[#7e5e3ee6]">3</span>
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        </div>
      }

      @if (!isLoading()) {
        <div class="flex flex-col gap-2 mb-4">
          @for (entry of leaderboardEntries(); track entry.id || entry.rank) {
            <div class="flex items-center gap-3 p-3 cursor-pointer" (click)="onUserClick(entry.username)">
              <div class="flex items-center gap-1 min-w-[40px]">
                <span class="body-14M font-semibold">{{ entry.rank }}</span>
                <i class="pi pi-angle-up text-green-500 text-xs"></i>
              </div>

              <div class="relative w-10 h-10 rounded-full overflow-hidden">
                <img
                  fill
                  placeholder
                  [ngSrc]="getUserImage(entry)"
                  [alt]="entry.name"
                  class="w-10 h-10 rounded-full object-cover shrink-0"
                  (error)="onImageError($event)"
                />
              </div>

              <div class="flex-1 body-14M">{{ getUserDisplayName(entry) }}</div>

              <!-- Score with diamond icon -->
              <div class="flex items-center gap-1">
                <img [src]="getDiamondPath(entry.points)" alt="diamond" class="w-6 h-6" />
                <span class="body-14M font-semibold">{{ formatScore(entry.points) }}</span>
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</ion-content>
<ion-footer mode="md">
  @if (userRank()) {
    <ion-toolbar>
      <div class="p-6 max-w-[672px] mx-auto flex items-center gap-3">
        <div class="flex items-center gap-1 min-w-[40px]">
          <span class="body-14M font-semibold">{{ userRank()!.rank }}</span>
          <i class="pi pi-angle-up text-green-500 text-xs"></i>
        </div>
        <div class="relative w-10 h-10 rounded-full overflow-hidden">
          <img
            fill
            placeholder
            [ngSrc]="getUserImage(userRank()!)"
            [alt]="userRank()!.name"
            class="w-10 h-10 rounded-full object-cover shrink-0"
            (error)="onImageError($event)"
          />
        </div>
        <div class="flex-1 body-14M font-semibold">{{ getUserDisplayName(userRank()!) }}</div>

        <div class="flex items-center gap-1">
          <img [src]="getDiamondPath(userRank()!.points)" alt="diamond" class="w-6 h-6" />
          <span class="body-14M font-semibold">{{ formatScore(userRank()!.points) }}</span>
        </div>
      </div>
    </ion-toolbar>
  }
</ion-footer>
