<ion-header mode="md">
  <ion-toolbar>
    <div class="p-6 max-w-[672px] mx-auto">
      <div class="flex items-center gap-2 cursor-pointer" (click)="back()">
        <div class="pi pi-arrow-left"></div>
        <div class="body-14M neutral-02 text-center w-full">
          {{ headerTitle() }}
        </div>
      </div>

      <div class="mt-4">
        <div class="body-12 neutral-03">{{ headerDescription() }}</div>
        <div class="heading-h2 neutral-01">{{ planName() }}</div>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" mode="md">
  <div class="min-h-full">
    <div class="w-full p-4 max-w-[672px] mx-auto">
      @if (showTabs()) {
        <div class="mb-4">
          <segment-button [items]="tabItems" [value]="tabValue()" (valueChange)="onTabChange($event)" />
        </div>
      }

      @if (viewMode() === 'included' && isLoading()) {
        <div class="flex items-center justify-center py-8">
          <div class="body-14M neutral-03">Loading...</div>
        </div>
      } @else if (viewMode() === 'add' && isLoadingEvents()) {
        <div class="flex items-center justify-center py-8">
          <div class="body-14M neutral-03">Loading events...</div>
        </div>
      }

      <!-- Events List -->
      @if ((viewMode() === 'included' && showIncludedEventsList()) || (viewMode() === 'add' && showAvailableEventsList())) {
        <div class="w-full">
          @for (group of currentGroupedEventsKeys(); track group) {
            <div class="flex flex-col gap-2 w-full">
              <div class="body-16M neutral-02 pt-3">{{ group }}</div>
              @for (event of currentGroupedEvents()[group]; track event?.id) {
                @if (showDeleteIcon() && !isEventCompleted(event)) {
                  <div class="flex items-center gap-3 w-full min-w-0">
                    <div class="flex-1 min-w-0">
                      <subscription-event-card [event]="event" [selected]="false" [showCheckbox]="false" />
                    </div>
                    <div class="flex-shrink-0 cursor-pointer p-2" (click)="removeEvent(event.id)">
                      <ion-icon src="assets/svg/deleteIcon.svg" class="w-5 h-5 text-red-600"></ion-icon>
                    </div>
                  </div>
                } @else {
                  <div class="w-full min-w-0">
                    <subscription-event-card
                      [event]="event"
                      [selected]="isEventSelected(event.id)"
                      [showCheckbox]="showCheckbox()"
                      (toggle)="toggleEventSelection(event.id)"
                    />
                  </div>
                }
              }
            </div>
          }

          @if (viewMode() === 'add' && hasMore()) {
            <ion-infinite-scroll threshold="100px" (ionInfinite)="loadMoreEvents($event)">
              <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more events..." />
            </ion-infinite-scroll>
          }
        </div>
      }

      <!-- Empty States -->
      @if (viewMode() === 'included' && showIncludedEmptyState()) {
        <app-empty-state
          [title]="'No Events Included'"
          [message]="'No events have been added to this subscription plan yet.'"
          [showClearButton]="false"
        />
      }

      @if (viewMode() === 'add' && showAvailableEmptyState()) {
        <app-empty-state
          [title]="'No Events Available'"
          [message]="'No events available to add to this subscription plan.'"
          [showClearButton]="false"
        />
      }
    </div>
  </div>
</ion-content>

<ion-footer mode="md">
  <ion-toolbar mode="md">
    <div class="p-6 max-w-[672px] mx-auto">
      @if (footerButtonConfig().type === 'single') {
        <app-button
          [label]="footerButtonConfig().label || ''"
          height="40px"
          [customColor]="footerButtonConfig().color"
          (click)="footerButtonConfig().action?.()"
        />
      } @else {
        <div class="flex items-center gap-2">
          <app-button
            [label]="footerButtonConfig().cancelLabel || ''"
            height="40px"
            color="secondary"
            class="flex-1"
            (click)="footerButtonConfig().onCancel?.()"
          />
          <app-button
            [label]="footerButtonConfig().confirmLabel || ''"
            height="40px"
            [customColor]="footerButtonConfig().color"
            class="flex-1"
            [disabled]="footerButtonConfig().disabled || false"
            [isLoading]="footerButtonConfig().isLoading || false"
            (click)="footerButtonConfig().onConfirm?.()"
          />
        </div>
      }
    </div>
  </ion-toolbar>
</ion-footer>
