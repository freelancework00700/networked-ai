<ion-header mode="md">
  <ion-toolbar mode="md">
    <div class="p-4 flex items-center justify-between">
      <i class="pi pi-arrow-left" (click)="close()"></i>
      <div class="heading-h3 neutral-01">{{ getTitle() }}</div>
      <i class="pi pi-times" (click)="close()"></i>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content mode="md">
  <div class="px-4">
    <form [formGroup]="ticketForm()" class="flex flex-col gap-4">
      <!-- Ticket Name -->
      <text-input controlName="name" label="Ticket Name" placeholder="Enter ticket name" />
      <div class="flex gap-2">
        <!-- Ticket Price -->
        <number-input
          controlName="price"
          label="Ticket Price"
          placeholder="Enter ticket price"
          class="w-full"
          [allowDecimal]="true"
          [iconName]="'pi-dollar'"
        />
        <!-- Available Quantity -->
        <number-input controlName="quantity" label="Available Quantity" placeholder="Enter available quantity" class="w-full" />
      </div>

      <!-- Free for Subscribers (only for paid tickets) -->
      @if (!isFreeTicket()) {
        <div class="flex items-center gap-2">
          <p-checkbox formControlName="free_for_subscribers" [binary]="true"></p-checkbox>
          <label class="text-sm text-gray-700 cursor-pointer">Free for Subscribers</label>
        </div>
      }

      <!-- Description -->
      <div>
        <text-area-input controlName="description" label="Description" placeholder="Enter description" [required]="false" />
        <div class="flex justify-end pt-1">
          <button type="button" class="flex items-center gap-1.5 brand-02 body-14M" (click)="handleGenerateClick()" [disabled]="isGeneratingDescription()">
            @if (isGeneratingDescription()) {
              <ion-spinner name="crescent" class="w-5 h-5"></ion-spinner>
            } @else {
              {{ isCustomize() ? 'Customize' : 'Generate' }}
              <img src="assets/svg/generateIcon.svg" alt="Generate" class="w-5 h-5" />
            }
          </button>
        </div>
      </div>

      <!-- Sales Start -->
      <div>
        <label class="block neutral-02 body-14M pb-1">Sale Start</label>
        <div class="flex items-center gap-2 w-full">
          <text-input
            label="Date"
            [showLabel]="false"
            iconName="pi-calendar"
            placeholder="Select date"
            (click)="openDateModal('sales_start_date')"
            controlName="sales_start_date"
            class="w-full"
          />
          <text-input
            label="Time"
            [showLabel]="false"
            iconName="pi-clock"
            placeholder="Select time"
            controlName="sale_start_time"
            (click)="openTimeModal('sale_start_time')"
            class="w-full"
          />
        </div>
      </div>

      <!-- End sale when event starts -->
      <div class="flex items-center gap-2">
        <p-checkbox formControlName="end_at_event_start" [binary]="true"></p-checkbox>
        <label class="text-sm text-gray-700 cursor-pointer">End sale when event starts</label>
      </div>

      <!-- Sales End (shown when end_at_event_start is false) -->
      @if (showEndSaleInputs()) {
        <div class="flex flex-col gap-1">
          <label class="block neutral-02 body-14M">Sale End</label>
          <div class="flex items-center gap-2 w-full">
            <text-input
              label="Date"
              iconName="pi-calendar"
              [showLabel]="false"
              (click)="openDateModal('sales_end_date')"
              placeholder="Select date"
              controlName="sales_end_date"
              class="w-full"
            />
            <text-input
              label="Time"
              iconName="pi-clock"
              [showLabel]="false"
              placeholder="Select time"
              controlName="sale_end_time"
              (click)="openTimeModal('sale_end_time')"
              class="w-full"
            />
          </div>
        </div>
      }
    </form>
  </div>
</ion-content>

<ion-footer mode="md">
  <ion-toolbar mode="md">
    <div class="p-4">
      <app-button label="Save Ticket" (click)="saveTicket()" />
    </div>
  </ion-toolbar>
</ion-footer>
