<div class="p-6 pb-0 h-full flex flex-col">
  <!-- title -->
  <div class="flex items-center justify-center mb-4 text-center">
    <div class="heading-h3 neutral-01">{{ title }}</div>
  </div>

  <!-- searchbar -->
  <div class="mb-6">
    <p-iconfield>
      <!-- search icon -->
      <p-inputicon class="pi pi-search" />

      <!-- search input -->
      <input pInputText [value]="searchQuery()" class="w-full h-[44px]" (input)="onSearchInput($event)" placeholder="Search for images..." />

      <!-- spinner when searching, clear icon when not searching and has value -->
      @if (isSearching()) {
        <p-inputicon class="pi pi-spin pi-spinner" />
      } @else if (searchQuery()) {
        <p-inputicon class="pi pi-times cursor-pointer" (click)="clearSearch()" />
      }
    </p-iconfield>
  </div>

  <!-- image grid with infinite scroll -->
  <ion-content>
    <div class="grid grid-cols-3 gap-1 px-2">
      @for (photo of photos(); track photo.id) {
        <div
          role="article"
          (click)="selectPhoto(photo)"
          class="aspect-square cursor-pointer rounded-[4px] overflow-hidden hover:opacity-80 transition-opacity relative"
        >
          <img [src]="photo.urls.regular" class="w-full h-full object-cover" loading="lazy" lazyImage />
          @if (multiSelect && isPhotoSelected(photo)) {
            <div
              class="absolute top-1 right-1 bg-brand-04 rounded-[4px] px-2 py-1 h-[20px] w-[20px] flex justify-center items-center body-14R neutral-01"
            >
              {{ getSelectionIndex(photo) }}
            </div>
          }
        </div>
      }
    </div>

    <!-- no results message -->
    @if (searchQuery().length > 0 && !isSearching() && photos().length === 0) {
      <div class="flex items-center justify-center py-8">
        <div class="body-14M neutral-03">No images found</div>
      </div>
    }

    <!-- loading state -->
    @if (isSearching() && photos().length === 0) {
      <div class="flex items-center justify-center py-8">
        <div class="body-14M neutral-03">Searching...</div>
      </div>
    }

    <!-- infinite scroll -->
    <ion-infinite-scroll threshold="100px" (ionInfinite)="onInfiniteScroll($event)" [disabled]="!hasMore()">
      <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Loading more images..." />
    </ion-infinite-scroll>
  </ion-content>
</div>

@if (multiSelect && selectedPhotos().length > 0) {
  <ion-footer class="ion-padding-horizontal border-t border-[#DBDBDB]">
    <ion-toolbar>
      <div class="flex items-center gap-4 bg-white min-h-[80px] px-2">
        <div class="flex-1 min-w-0 overflow-visible py-2 pr-2">
          <div
            class="flex items-center gap-2 overflow-x-auto py-2 max-sm:[&::-webkit-scrollbar]:hidden max-sm:[-ms-overflow-style:none] max-sm:[scrollbar-width:none]"
          >
            @for (photo of selectedPhotos(); track photo.id) {
              <div class="relative flex-shrink-0">
                <img [src]="photo.urls.thumb" class="w-[48px] h-[48px] rounded-[4px] object-cover block" loading="lazy" lazyImage />

                <div
                  (click)="removeSelectedPhoto(photo)"
                  class="absolute -top-1 -right-1 w-[16px] h-[16px] border border-white bg-neutral-04 text-neutral-07 rounded-full flex items-center justify-center cursor-pointer"
                >
                  <i class="pi pi-times neutral-07 !text-[6px]"></i>
                </div>
              </div>
            }
          </div>
        </div>

        <app-button label="Next" width="100px" height="48px" (click)="confirmSelection()" />
      </div>
    </ion-toolbar>
  </ion-footer>
}
