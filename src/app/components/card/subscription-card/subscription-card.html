<div
  class="subscription-card rounded-xl transition"
  [class.card-event]="data().type === 'event'"
  [class.card-sponsor]="data().type === 'sponsor'"
  [class.card-select]="isSelectMode()"
  [class.cursor-pointer]="mode() === 'subscription' || mode() === 'select'"
  [class.selected]="isSelectMode() && isSelected()"
  [class.unselected]="isSelectMode() && !isSelected()"
  (click)="mode() === 'subscription' ? onClick() : mode() === 'select' && checkboxControl() ? toggleCheckbox() : null"
>
  @if (isSelectMode() || isPlanMode()) {
    <!-- Select Mode or Plan Mode -->
    <div class="flex items-center gap-3 relative">
      <!-- Icon -->
      <div class="bg-white rounded-2xl shadow-md p-2 flex items-center">
        <div class="plan-icon" [class.icon-event]="data().type === 'event'" [class.icon-sponsor]="data().type === 'sponsor'">
          @if (data().type === 'sponsor') {
            <ion-icon src="/assets/svg/subscription/sponsorIcon.svg" class="text-2xl!"></ion-icon>
          } @else {
            <i class="pi pi-crown text-xl!"></i>
          }
        </div>
      </div>

      <!-- Plan Details -->
      <div class="flex-1 min-w-0 pr-10">
        <div class="body-18SB neutral-01 mb-1 truncate">
          {{ getDisplayName() }}
        </div>

        <div class="flex items-center gap-2 min-w-0">
          <div class="body-12R neutral-03 mb-1 pr-2 border-r-1 whitespace-nowrap">
            <b class="neutral-01">{{ data().subscribers }}</b> subscribers
          </div>
          <div class="body-12R neutral-03 truncate min-w-0">
            {{ data().priceRange }}
          </div>
        </div>
      </div>

      <!-- Delete Icon (only for plan mode) -->
      @if (isPlanMode()) {
        <button
          type="button"
          class="absolute top-0 right-0 p-2 text-neutral-03 hover:opacity-70 transition-opacity cursor-pointer"
          (click)="onDelete($event)"
          aria-label="Delete plan"
        >
          <img src="/assets/svg/deleteIcon.svg" alt="Delete" class="w-5 h-5" />
        </button>
      }

      <!-- Checkbox (only for select mode) -->
      @if (isSelectMode() && checkboxControl()) {
        <p-checkbox [ngModel]="isSelected()" (ngModelChange)="toggleCheckbox($event)" [binary]="true"></p-checkbox>
      }
    </div>

    <!-- Buttons (only for plan mode) -->
    @if (isPlanMode()) {
      <div class="pt-4 flex items-center gap-2">
        <app-button label="Manage" color="secondary" class="flex-1" (click)="onManage()" iconName="pi-cog" />
        <app-button label="Events" color="secondary" class="flex-1" (click)="onEvents()" iconName="pi-calendar" />
      </div>
    }
  } @else {
    <!-- Subscription Mode -->
    <!-- Icon -->
    <div class="flex items-center gap-3 border-b-1 border-neutral-200 pb-3">
      <div class="bg-white rounded-2xl shadow-md p-2 flex items-center">
        <div class="plan-icon" [class.icon-event]="data().type === 'event'" [class.icon-sponsor]="data().type === 'sponsor'">
          @if (data().type === 'sponsor') {
            <ion-icon src="/assets/svg/subscription/sponsorIcon.svg" class="text-2xl!"></ion-icon>
          } @else {
            <i class="pi pi-crown text-xl!"></i>
          }
        </div>
      </div>

      <!-- Subscription Details -->
      <div class="flex-1 min-w-0">
        <div class="body-18SB neutral-01 mb-1 truncate">
          {{ getDisplayName() }}
        </div>

        <div class="flex items-center gap-2">
          <div class="relative w-5 h-5 flex-shrink-0 overflow-hidden rounded-full">
            <img
              fill
              priority
              placeholder
              [alt]="data().creatorName || 'avatar'"
              class="rounded-full object-cover"
              (error)="onImageError($event)"
              [ngSrc]="getImageUrl(data().thumbnail_url)"
            />
          </div>
          <div class="body-12 neutral-02 truncate">
            {{ data().creatorName }}
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4 flex justify-between">
      <div class="flex gap-8">
        <div class="body-12 neutral-03 mb-1">
          <div>{{ data().cancelDate ? 'Cancel on' : 'Renews on' }}</div>
          <div class="mt-1">Billing</div>
        </div>
        <div class="body-12M neutral-01">
          <div [ngClass]="data().cancelDate ? 'text-red-500' : 'neutral-01'">
            {{ data().cancelDate ? (data().cancelDate | date: 'MMM d, yyyy') : (data().renewDate | date: 'MMM d, yyyy') }}
          </div>
          <div class="mt-1">{{ data().price }}</div>
        </div>
      </div>

      <i class="pi pi-arrow-right neutral-03 text-lg flex items-end pb-1"></i>
    </div>
  }
</div>
